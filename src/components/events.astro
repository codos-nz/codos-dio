---
import ContentSection from "~/components/content-section.astro";
import ShowcaseCard from "~/components/showcase-card.astro";
import NewEventsCard from "~/components/new-events.astro";
const paramsObj = {
  row: "20",
  username: import.meta.env.USERNAME,
  fields: import.meta.env.QUERY_FIELDS,
  date_format: "%e %b",
};
const baseUrl = new URL(
  import.meta.env.EVENTFINDA_BASE_URL +
    `?${new URLSearchParams(paramsObj).toString()}`
);
const headers = new Headers({
  "Content-Type": "application/json",
  Authorization: import.meta.env.API_KEY,
  cache: "default",
  mode: "cors",
  method: "GET",
  "Cache-Control": "s-maxage=1, stale-while-revalidate",
});
const response = await fetch(baseUrl, { headers });
const { events } = await response.json();
---

<ContentSection title="Upcoming Events" id="events">
  <Fragment slot="lead">
    Click on the event to buy your <span class="text-primary">tickets</span>{
      " "
    }today!!!
  </Fragment>
  <div class="max-w-6xl space-y-2">
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
      {
        events.map(
          ({ name, images, url, datetime_summary, location_summary }) => (
            <ShowcaseCard
              title={
                String(name).toUpperCase().startsWith("DRAG IT OUT")
                  ? String(name)
                      .split(/([Pp][Rr][Ee][Ss][Ee][Nn][Tt][Ss]\s)+/g)
                      .at(-1)
                  : "Drag It Out"
              }
              image={images.images[0].original_url}
              url={url}
              date={datetime_summary}
              location={location_summary}
            />
          )
        )
      }
    </div>
    <p class="text-lg text-right">
      <a
        class="text-primary after:content-['_â†—']"
        href="https://www.eventfinda.co.nz/user/dragitoutchch/favourites/events"
        target="_blank"
      >
        ...and more
      </a>
    </p>
    <br />
    <NewEventsCard events={events} />
  </div>
</ContentSection>
